{% extends "base.html" %}

{% block title %}Varastot - Varastohallinta{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <h1>Varastot</h1>
        <hr>
        
        {% if warehouses %}
            <div class="row">
                {% for id, warehouse in warehouses.items() %}
                    <div class="col-md-4">
                        <div class="card warehouse-card">
                            <div class="card-header bg-primary text-white">
                                <h5 class="mb-0">{{ warehouse.name }}</h5>
                            </div>
                            <div class="card-body">
                                <p class="mb-2">
                                    <strong>Saldo:</strong> 
                                    {{ "%.2f"|format(warehouse.varasto.saldo) }}
                                </p>
                                <p class="mb-2">
                                    <strong>Tilavuus:</strong> 
                                    {{ "%.2f"|format(warehouse.varasto.tilavuus) }}
                                </p>
                                <p class="mb-2">
                                    <strong>Vapaana:</strong> 
                                    {{ "%.2f"|format(warehouse.varasto.paljonko_mahtuu()) }}
                                </p>
                                
                                <div class="progress-bar-container">
                                    <div class="progress">
                                        {% set percentage = (warehouse.varasto.saldo / warehouse.varasto.tilavuus * 100) if warehouse.varasto.tilavuus > 0 else 0 %}
                                        <div class="progress-bar 
                                             {% if percentage > 90 %}bg-danger
                                             {% elif percentage > 70 %}bg-warning
                                             {% else %}bg-success{% endif %}" 
                                             role="progressbar" 
                                             style="width: {{ percentage }}%">
                                            {{ "%.0f"|format(percentage) }}%
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mt-3">
                                    <a href="{{ url_for('warehouse_detail', warehouse_id=id) }}" 
                                       class="btn btn-sm btn-primary">
                                        Näytä
                                    </a>
                                    <a href="{{ url_for('add_stock', warehouse_id=id) }}" 
                                       class="btn btn-sm btn-success">
                                        Lisää
                                    </a>
                                    <a href="{{ url_for('remove_stock', warehouse_id=id) }}" 
                                       class="btn btn-sm btn-warning">
                                        Ota
                                    </a>
                                    <form method="POST" 
                                          action="{{ url_for('delete_warehouse', warehouse_id=id) }}" 
                                          style="display: inline;"
                                          onsubmit="return confirm('Haluatko varmasti poistaa varaston?');">
                                        <button type="submit" 
                                                class="btn btn-sm btn-danger">
                                            Poista
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="alert alert-info">
                <p class="mb-0">
                    Ei varastoja. 
                    <a href="{{ url_for('create_warehouse') }}">
                        Luo ensimmäinen varasto
                    </a>
                </p>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
